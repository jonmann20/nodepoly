<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="sticky-note.html">

<dom-module id="sticky-notes">
	<template>
		<template is="dom-repeat" items="[[notes]]" as="note">
			<sticky-note
				on-note-answered="handleNoteAnswered"
				id="[[note.id]]"
				title="[[note.title]]"
				answer-positive="[[note.answerPositive]]"
				answer-negative="[[note.answerNegative]]"
			></sticky-note>
		</template>

		<iron-ajax
			id="saveNoteResponse"
			url="/note-response.json"
			method="POST"
			content-type="application/json"
			on-response="handleNoteResponseSaved"
			handle-as="json"
		></iron-ajax>
	</template>
	<script>
		StickyNotes = Polymer({
			is: 'sticky-notes',

			properties: {
				notes: Array
			},

			handleNoteAnswered: function(e, id, isPositive) {
				// Remove note
				this.notes.forEach((note, i) => {
					if(note.id === id) {
						this.splice('notes', i, 1);
						return;
					}
				});

				// Save response
				this.$.saveNoteResponse.body = `{"id": "${id}", "isPositive": "${isPositive}"}`;
				this.$.saveNoteResponse.generateRequest();
			},

			handleNoteResponseSaved: function(e) {
				const r = e.detail.response;
				console.log(r.status, r.message);
			}
		});
 	</script>
</dom-module>