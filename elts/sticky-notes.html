<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="sticky-note.html">

<dom-module id="sticky-notes">
	<template>
		<template is="dom-repeat" items="{{notes}}" as="note">
			<sticky-note id="n{{note.id}}" title="{{note.title}}" answer-positive="{{note.answerPositive}}" answer-negative="{{note.answerNegative}}"></sticky-note>
		</template>
	</template>
	<script>
		Polymer({
			is: 'sticky-notes',

			ready: function() {
				this.notes = [
					{
						id: 0,
						title: 'Have you visited your primary care physician?'
					},
					{
						id: 1,
						title: 'Have you taken your medication this morning?'
					},
					{
						id: 2,
						title: 'How many drinks have you had in the last week?',
						answerPositive: '0-3',
						answerNegative: '3+'
					}
				];

				// TODO: observeNodes ==> stickyNote.detached
				this.async(() => {
					let stickyNotes = document.querySelectorAll('sticky-note');
					for(let note of stickyNotes) {
						note.addEventListener('sticky-note-destroyed', e => {
							this.removeNote(parseInt(e.detail));
						});
					}
				});
			},

			removeNote: function(id) {
				this.notes.forEach((note, i) => {
					if(note.id === id) {
						//console.log('removing', note);
				 		this.notes.splice(i, 1);

				 		// TODO: remove event listener

				 		return;
					}
				});

				//console.log(this.notes);
				this.fire('sticky-notes-changed');
			}
		});
  </script>
</dom-module>