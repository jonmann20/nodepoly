<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="sticky-note.html">

<dom-module id="sticky-notes">
	<script>
		Polymer({
			is: 'sticky-notes',
			properties: {
				notes: {
					type: Array,
					value: () => []
				}
			},

			ready: function() {
				const notesData = [
					{
						id: 'n0',
						title: 'Have you visited your primary care physician?'
					},
					{
						id: 'n1',
						title: 'Have you taken your medication this morning?'
					},
					{
						id: 'n2',
						title: 'How many drinks have you had in the last week?',
						answerPositive: '0-3',
						answerNegative: '3+'
					}
				];

				// TODO: not working with c9 redirect
				// fetch('/notes.json', {mode: 'no-cors'}).then(response => {
				// 	console.log(response);
				// });

				notesData.forEach(data => this.addNote(new StickyNote(data)));

				// TODO: Use the built in polymer observer on notes
				// or listen for stickyNote.detached rather than custom event
			},

			addNote: function(note) {
				this.push('notes', note);
				this.listen(note, 'sticky-note-removed', 'removeNote')
				Polymer.dom(this.root).appendChild(note);
			},

			removeNote: function(e) {
				const id = e.detail;

				this.notes.forEach((note, i) => {
					if(note.id === id) {
						this.unlisten(note, 'sticky-note-removed', 'removeNote');
						this.splice('notes', i, 1);
						this.fire('sticky-notes-changed');
						return;
					}
				});
			}
		});
	</script>
</dom-module>